import Head from 'next/head'
import Image from 'next/image'
import styles from '../styles/Home.module.css'
import {useState,useEffect, createContext} from 'react'
import {useRouter} from'next/router'
import {Button,Form,Loader} from 'semantic-ui-react'
import Link from 'next/link'
export default function Home() {
  const [form,setForm] = useState({name:'',email:'',phone:'',number:''})
  const[isSubmitting,setIsSubmitting]=useState(false)
  const [errors,setErrors]=useState({})
  const router = useRouter()
  
  useEffect(() => {
      if(isSubmitting){
        if(Object.keys(errors).length === 0){
          createNote();
          alert('Show this certification to staff')
        }
        else{
          setIsSubmitting(false)
        }
      }
  },[errors])
  const createNote = async()=>{
    try{
      const res = await fetch('https://1992shisha.netlify.app/api/hh',{
        method:'POST',
        headers:{
          "Accept":"application/json",
          "Content-Type":"application/json"
        },
        body:JSON.stringify(form)
      })
      router.push("/")
    }catch(error){
      console.log(error)
    }
  }

  const handleSubmit = (e)=>{
    e.preventDefault()
    let errs = validate();
    setErrors(errs)
    setIsSubmitting(true)
  }

  const handleChange = (e)=>{
    setForm({
      ...form,
        [e.target.name]:e.target.value
    })
  }
  const validate = ()=>{
    let err = {}
    if(!form.name){
      err.name='Name is required'
    }
    if(!form.email){
      err.email='Email is required'
    }
    if(!form.phone){
      err.phone='Phone is required'
    }
    if(!form.number){
      err.number='Number is required'
    }
    return err
  }
  return (
    <div className={styles.container}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div className="form-container">
        <h1>Create Note</h1>
        <div>
            {isSubmitting ? <Loader active inline='centered'/>
                            :<Form onSubmit={handleSubmit}>
                              <Form.Input 
                                fluid
                                label='name'
                                name='name'
                                error={errors.name?{content:'enter a title',pointing:'below'}:null}
                                onChange={handleChange}
                                />
                                 <Form.Input 
                                fluid
                                error={errors.email?{content:'enter a email',pointing:'below'}:null}
                                label='email'
                                name='email'
                                type='email'
                                onChange={handleChange}
                                />
                                 <Form.Input 
                                fluid
                                error={errors.phone?{content:'enter a phone',pointing:'below'}:null}
                                label='phone'
                                name='phone'
                                onChange={handleChange}
                                />
                                 <Form.Input 
                                fluid
                                error={errors.number?{content:'enter a number',pointing:'below'}:null}
                                label='number'
                                name='number'
                                onChange={handleChange}
                                />
                                <Button type="submit">Submit</Button>
                            </Form>
          }
                            
        </div>
      </div>
     
      
    </div>
  )
}
